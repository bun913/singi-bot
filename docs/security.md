# セキュリティ周りの検討

本Botはあくまで個人の検証用としての立ち位置であるものの、もしこのBotを社内のSlackに載せるのであればどのような対策を行うか検討してみた。

## 基本方針

- コストは最小限にする
  -  Lambda + API Gatewayでアプリを動作させるように、本プロジェクトではコストを最小限にしつつ極力スケールしやすい構成をとる
- 企業ルール遵守
  - 企業や業界ごとのルールや標準がある場合、それらを遵守して正しくAIを使った「生産性向上」「コミュニケーション活発化」などに寄与する
- トレーサビリティの確保
  - Bedrock単体では「誰が」「いつ」「何を利用したか」というログを意図的に取らないように設定されている
  - CloudWatch Logs に対してログを出力し、適切な期間保持し、デフォルトの保管中の暗号化オプションを有効に設定する
- 極力自動化された運用体制
  - AWS には運用上のベストプラクティスが明示されており、それを為すために「マネージドサービス」が存在している
  - 本Botを稼働させるにあたってAWS内外のマネージドサービスを利用して極力運用上のコストを低減させる

## AWS アカウント管理

一般的なアカウント管理のベストプラクティスに則って、本BotをデプロイするAWSアカウントとCloudTrail などのログ保管アカウントを分離する。

アカウント構成イメージは以下のとおり。

![multi-account](./security/account.drawio.svg)

すでに企業が運用するアカウント群があり、Control Tower などを活用している場合新たにProduction Account を作成してそこに本リポジトリの IaCコードを活用してアプリをデプロイするのが最も簡潔だと思われる。

なお、Bot アプリケーションのログに関しては Productionアカウント内の CloudWatch Logs への出力を行う想定である。

アクセスログには「誰が」「いつ」「どのような入力をしたか」という機密情報を出力することになるが、アプリケーションのログと開発者による運用は不可分のものであると考えている。

そこを無理に分離するよりも、一体化した上で Audit ログなどに「誰が」「どのAWSサービスに対して」「どのように」「いつアクセスしたか」といった監査ログを出力して監視体制を保持した方がメリットが大きいと判断した。

## Bedrock 活用にあたる各種規定など

2024年7月現在であれば、AWSの `Data protection` のページに以下の要点が明記されている。

- promptのログを取得しない
- 学習に利用しない
- サードパーティにもデータを提供しない

### 参考規定

- [AWSのサービス条件](https://aws.amazon.com/jp/service-terms/)
- [Data protection - Amazon Bedrock](https://docs.aws.amazon.com/bedrock/latest/userguide/data-protection.html)

## その他 AWSに関わらない考慮事項

### ソースコード

- 企業が管理する SVNサービス（GitHubやGitLab）にて適切にソースコードを管理する
  - アクセスできるユーザー制御
  - バージョン管理の徹底（force push などの禁止）
- GitHub を利用する場合 Dependabot による依存性管理を自動化する
- その他ブランチ戦略や、CI・CD戦略などは管理部門の規定に従う

### Bot利用にあたるルールの徹底

- 会話履歴データはDynamoDBに保管した上で、古いメッセージは消去するとはいえ機密情報を入力しないことを明記する
  - 業務上の機密情報や顧客情報などは決して入力しないこと
  - アクセスログを取得していることを明示する
  - その上で、「気軽な相談」、「開発上の相談」、「コミュニケーション活性化のための利用」を行っていいことを明示するなどの工夫を行う
- 企業ごとの「生成AI利用ガイドライン」や「セキュリティポリシー」などと合わせてルールを規定すること
  - あまりガチガチに固めて利用を忌避されるような本末転倒な自体を避ける
  - 本Botの開発者やセキュリティ管理者こそが気軽に使っている様を見せるのが望ましい

### 運用管理

本サービスは「社内利用のChatbot」という位置付けであり、明確な「死活監視」などを行うことは想定していない。（社内からの「利用できない」という発信起因で最初は十分であると考えている）

一方で「AWS アカウント管理」に記載するとおりセキュリティ上の通知などは管理担当部門に通知を行うことでセキュアな状態を保つのが望ましい。
